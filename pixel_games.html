<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒç´ å¤§å†’é™© - å®ƒæ˜¯æ€ä¹ˆç»„æˆçš„ï¼Ÿ</title>
    <!-- ä½¿ç”¨ Tailwind CSS è¿›è¡Œå¿«é€Ÿç¾åŒ– -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');

        body {
            font-family: 'ZCOOL KuaiLe', cursive, sans-serif; /* ä½¿ç”¨å¯çˆ±çš„å­—ä½“é£æ ¼ */
            background-color: #f0f9ff;
            background-image: radial-gradient(#bae6fd 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* åƒç´ åŒ–æ¸²æŸ“ï¼Œå…³é”® CSS */
        .pixelated {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .grid-cell {
            transition: transform 0.1s;
            cursor: pointer;
        }
        .grid-cell:hover {
            transform: scale(0.95);
            z-index: 10;
        }
        .grid-cell:active {
            transform: scale(0.85);
        }

        /* ä»»åŠ¡å››ä¸“ç”¨æ ·å¼ï¼šæ•°å­—æ ¼å­ */
        .number-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #ccc;
            user-select: none;
            transition: all 0.2s;
        }
        .number-cell.solved {
            color: transparent; /* å¡«è‰²åéšè—æ•°å­— */
            transform: scale(1);
            border: none;
        }
        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        /* è‡ªå®šä¹‰æ»‘å—æ ·å¼ */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 30px;
            width: 30px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            margin-top: -12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #bfdbfe;
            border-radius: 5px;
        }
        
        /* é’ˆå¯¹ä»»åŠ¡ä¸‰çš„ä¸åŒé¢œè‰²æ»‘å— */
        #imagePixelSlider::-webkit-slider-thumb {
            background: #f59e0b; /* Amber-500 */
        }
        #imagePixelSlider::-webkit-slider-runnable-track {
            background: #fde68a; /* Amber-200 */
        }

        /* ä»»åŠ¡äº”ï¼šåŠ¨ç”»æ ¼å­ */
        .anim-cell {
            background-color: white;
            border: 1px solid #eee;
        }
    </style>
</head>
<body class="text-gray-800 select-none">

    <!-- é¡¶éƒ¨æ ‡é¢˜åŒº -->
    <header class="text-center py-8 px-4">
        <h1 class="text-5xl md:text-6xl text-blue-600 drop-shadow-md mb-4">ğŸ‘¾ åƒç´ å¤§å†’é™© ğŸ‘¾</h1>
        <p class="text-xl md:text-2xl text-gray-600 bg-white inline-block px-6 py-2 rounded-full shadow-lg border-2 border-blue-200">
            å›¾ç”»æ˜¯ç”±åƒä¸‡ä¸ªå°æ–¹å—ç»„æˆçš„ï¼
        </p>
    </header>

    <main class="max-w-4xl mx-auto px-4 space-y-12 pb-20">

        <!-- ç¬¬ä¸€è¯¾ï¼šä»€ä¹ˆæ˜¯åƒç´ ï¼Ÿï¼ˆè§‚å¯Ÿæ¨¡å¼ï¼‰ -->
        <section class="bg-white rounded-3xl p-6 md:p-8 shadow-xl border-b-8 border-blue-200">
            <div class="flex flex-col items-center">
                <h2 class="text-3xl text-purple-600 mb-6 flex items-center">
                    <span class="bg-purple-100 p-2 rounded-lg mr-3">ğŸ”</span> 
                    ä»»åŠ¡ä¸€ï¼šå˜èº«ä¾¦æ¢
                </h2>
                <p class="text-lg text-gray-500 mb-6 text-center">
                    è¿™çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªæ¸…æ™°çš„è˜‘è‡ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠå®ƒå˜å¾—å¾ˆå°ï¼Œå†å¼ºè¡Œæ”¾å¤§ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ<br>
                    <span class="text-blue-500 font-bold">æ‹–åŠ¨ä¸‹é¢çš„æ»‘å—è¯•è¯•çœ‹ï¼</span>
                </p>

                <!-- åƒç´ å˜æ¢å±•ç¤ºåŒº -->
                <div class="relative w-64 h-64 bg-gray-100 rounded-xl overflow-hidden border-4 border-gray-300 shadow-inner mb-6 flex items-center justify-center">
                    <!-- è¿™ä¸ª Canvas ç”¨æ¥åŠ¨æ€ç»˜åˆ¶ä½åˆ†è¾¨ç‡å›¾åƒ -->
                    <canvas id="pixelCanvas" width="8" height="8" class="pixelated w-full h-full object-contain"></canvas>
                    
                    <!-- åŸå§‹çš„é«˜æ¸… Emoji (ä½œä¸ºå‚è€ƒæˆ–æº) -->
                    <div id="sourceEmoji" style="display:none; font-size: 100px;">ğŸ„</div>
                </div>

                <div class="w-full max-w-md bg-blue-50 p-4 rounded-xl">
                    <div class="flex justify-between text-lg font-bold text-blue-800 mb-2">
                        <span>å…¨æ˜¯æ–¹å— (åƒç´ ä½)</span>
                        <span>å¾ˆæ¸…æ™° (åƒç´ é«˜)</span>
                    </div>
                    <input type="range" id="resolutionSlider" min="4" max="128" value="128" step="1" class="w-full">
                    <div class="text-center mt-2 text-xl text-blue-600">
                        å½“å‰æ–¹å—æ•°é‡ï¼š<span id="resValue" class="font-bold text-2xl">å¾ˆå¤š</span>
                    </div>
                </div>

                <div class="mt-6 bg-yellow-100 p-4 rounded-lg text-yellow-800 text-lg">
                    ğŸ’¡ <strong>å°çŸ¥è¯†ï¼š</strong> æ¯ä¸€ä¸ªå°è‰²å—å°±å«ä¸€ä¸ª <strong>â€œåƒç´ â€ (Pixel)â€</strong>ã€‚åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œæ–¹å—è¶Šå¤šï¼Œç”»å°±è¶Šæ¸…æ¥šï¼
                </div>
            </div>
        </section>

        <!-- ç¬¬äºŒè¯¾ï¼šæˆ‘æ¥ç”»åƒç´ ï¼ˆåˆ›é€ æ¨¡å¼ï¼‰ -->
        <section class="bg-white rounded-3xl p-6 md:p-8 shadow-xl border-b-8 border-green-200">
            <div class="flex flex-col items-center">
                <h2 class="text-3xl text-green-600 mb-6 flex items-center">
                    <span class="bg-green-100 p-2 rounded-lg mr-3">ğŸ¨</span>
                    ä»»åŠ¡äºŒï¼šæˆ‘æ˜¯å°ç”»å®¶
                </h2>
                <p class="text-lg text-gray-500 mb-6 text-center">
                    æ—¢ç„¶å›¾ç”»æ˜¯æ–¹å—ç»„æˆçš„ï¼Œé‚£æˆ‘ä»¬ä¹Ÿæ¥ç”¨æ–¹å—ç”»ç”»å§ï¼<br>
                    <span class="text-green-500 font-bold">ç‚¹å‡»ä¸‹é¢çš„æ ¼å­å¡«è‰²ã€‚</span>
                </p>

                <!-- é¢œè‰²é€‰æ‹©å™¨ -->
                <div class="flex gap-4 mb-6 bg-gray-100 p-3 rounded-full shadow-inner flex-wrap justify-center">
                    <button onclick="setColor('red')" class="w-12 h-12 rounded-full bg-red-500 hover:scale-110 transition ring-4 ring-transparent hover:ring-red-200 focus:ring-red-300 shadow-md transform active:scale-90" aria-label="çº¢è‰²"></button>
                    <button onclick="setColor('#3b82f6')" class="w-12 h-12 rounded-full bg-blue-500 hover:scale-110 transition ring-4 ring-transparent hover:ring-blue-200 focus:ring-blue-300 shadow-md transform active:scale-90" aria-label="è“è‰²"></button>
                    <button onclick="setColor('#22c55e')" class="w-12 h-12 rounded-full bg-green-500 hover:scale-110 transition ring-4 ring-transparent hover:ring-green-200 focus:ring-green-300 shadow-md transform active:scale-90" aria-label="ç»¿è‰²"></button>
                    <button onclick="setColor('#facc15')" class="w-12 h-12 rounded-full bg-yellow-400 hover:scale-110 transition ring-4 ring-transparent hover:ring-yellow-200 focus:ring-yellow-300 shadow-md transform active:scale-90" aria-label="é»„è‰²"></button>
                    <button onclick="setColor('black')" class="w-12 h-12 rounded-full bg-gray-900 hover:scale-110 transition ring-4 ring-transparent hover:ring-gray-300 focus:ring-gray-400 shadow-md transform active:scale-90" aria-label="é»‘è‰²"></button>
                    <!-- æ©¡çš®æ“¦ -->
                    <button onclick="setColor('white')" class="w-12 h-12 rounded-full bg-white border-2 border-gray-300 flex items-center justify-center hover:scale-110 transition shadow-md text-xl" title="æ©¡çš®æ“¦">ğŸ§½</button>
                </div>
                
                <div id="currentColorDisplay" class="mb-4 text-lg">
                    ç°åœ¨æ‰‹é‡Œæ‹¿çš„æ˜¯ï¼š<span class="font-bold px-3 py-1 rounded text-white shadow" style="background-color: red;">çº¢è‰²</span>
                </div>

                <!-- 10x10 ç”»å¸ƒ -->
                <div id="pixelGrid" class="grid grid-cols-10 gap-0.5 bg-gray-300 p-1 rounded border-4 border-gray-400 shadow-lg touch-none" style="width: 320px; height: 320px;">
                    <!-- æ ¼å­å°†é€šè¿‡ JS ç”Ÿæˆ -->
                </div>

                <div class="flex gap-4 mt-6">
                    <button onclick="clearGrid()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-6 rounded-full transition shadow-md">
                        ğŸ—‘ï¸ å…¨éƒ¨æ“¦æ‰
                    </button>
                </div>
            </div>
        </section>

        <!-- ç¬¬ä¸‰è¯¾ï¼šä¸‡ç‰©çš†åƒç´  (ä¸Šä¼ æ¨¡å¼) -->
        <section class="bg-white rounded-3xl p-6 md:p-8 shadow-xl border-b-8 border-yellow-400">
            <div class="flex flex-col items-center">
                <h2 class="text-3xl text-yellow-600 mb-6 flex items-center">
                    <span class="bg-yellow-100 p-2 rounded-lg mr-3">ğŸ“¸</span>
                    ä»»åŠ¡ä¸‰ï¼šä¸‡ç‰©çš†åƒç´ 
                </h2>
                <p class="text-lg text-gray-500 mb-6 text-center">
                    ä½ å¯ä»¥ä¸Šä¼ ä¸€å¼ è‡ªå·±çš„ç…§ç‰‡ï¼Œçœ‹çœ‹å®ƒå˜æˆåƒç´ ç”»æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼<br>
                    <span class="text-orange-500 font-bold">ä¸€å¼€å§‹æ˜¯æ¸…æ™°çš„ï¼Œå¾€å·¦æ‹–åŠ¨è®©å®ƒâ€œå˜æ–¹â€ï¼</span>
                </p>

                <!-- ä¸Šä¼ æ§ä»¶ -->
                <div class="mb-6 w-full max-w-md">
                    <label class="block w-full flex flex-col items-center px-4 py-6 bg-orange-50 text-orange-500 rounded-xl shadow-lg tracking-wide uppercase border border-orange-200 cursor-pointer hover:bg-orange-100 transition active:scale-95">
                        <span class="text-4xl mb-2">ğŸ“¤</span>
                        <span class="text-xl leading-normal font-bold">ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</span>
                        <input type='file' class="hidden" id="uploadInput" accept="image/*" />
                    </label>
                </div>

                <!-- åƒç´ æ§åˆ¶ (é»˜è®¤éšè—ï¼Œä¸Šä¼ åæ˜¾ç¤º) -->
                <div class="w-full max-w-md bg-yellow-50 p-4 rounded-xl mb-6 hidden transition-all duration-500" id="pixelControlArea">
                    <div class="flex justify-between text-lg font-bold text-yellow-800 mb-2">
                        <span>æ–¹å—å¤§ (åƒç´ é£)</span>
                        <span>æ–¹å—å° (é«˜æ¸…)</span>
                    </div>
                    <!-- é»˜è®¤å€¼è®¾ä¸º 100ï¼Œä¸€å¼€å§‹å°±æ˜¯é«˜æ¸… -->
                    <input type="range" id="imagePixelSlider" min="1" max="100" value="100" step="1" class="w-full">
                    <div class="text-center mt-2 text-xl text-yellow-700">
                        ç…§ç‰‡æ ·å­ï¼š<span id="imgResText" class="font-bold text-2xl">é«˜æ¸…ç…§ç‰‡</span>
                    </div>
                </div>

                <!-- å›¾ç‰‡å±•ç¤ºåŒº -->
                <div class="relative w-full max-w-md bg-gray-100 rounded-xl overflow-hidden border-4 border-gray-300 shadow-inner min-h-[300px] flex items-center justify-center">
                    <div id="imgPlaceholder" class="text-center p-4">
                        <span class="text-6xl block mb-2">ğŸ–¼ï¸</span>
                        <p class="text-gray-400 text-xl">å›¾ç‰‡ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                    <!-- å›¾ç‰‡ Canvas -->
                    <canvas id="imageCanvas" class="pixelated w-full h-auto hidden"></canvas>
                </div>
            </div>
        </section>

        <!-- ç¬¬å››è¯¾ï¼šæ•°å­—è§£å¯† (Puzzleæ¨¡å¼) -->
        <section class="bg-white rounded-3xl p-6 md:p-8 shadow-xl border-b-8 border-pink-400">
            <div class="flex flex-col items-center">
                <h2 class="text-3xl text-pink-600 mb-6 flex items-center">
                    <span class="bg-pink-100 p-2 rounded-lg mr-3">ğŸ§©</span>
                    ä»»åŠ¡å››ï¼šæ•°å­—è§£å¯†
                </h2>
                <p class="text-lg text-gray-500 mb-6 text-center">
                    ç”µè„‘å…¶å®ä¸è®¤è¯†é¢œè‰²ï¼Œå®ƒåªè®¤è¯†<strong>æ•°å­—</strong>ï¼<br>
                    <span class="text-pink-500 font-bold">è¯·æ ¹æ®ä¸‹é¢çš„æ•°å­—ä»£ç ï¼Œå¸®ç”µè„‘è¿˜åŸè¿™å¹…ç”»å§ã€‚</span>
                </p>

                <!-- æ¸¸æˆçŠ¶æ€æç¤º -->
                <div id="puzzleMessage" class="h-8 mb-4 text-xl font-bold text-pink-500">
                    æ‹¿èµ·ç”»ç¬”å¼€å§‹å§ï¼
                </div>

                <!-- è°ƒè‰²æ¿ (æ•°å­—æ˜ å°„) -->
                <div class="flex gap-6 mb-6 bg-pink-50 p-4 rounded-xl shadow-inner">
                    <div onclick="setPuzzleTool(1)" class="puzzle-tool cursor-pointer flex flex-col items-center gap-1 hover:scale-110 transition transform active:scale-95" id="tool-1">
                        <div class="w-12 h-12 rounded-full bg-red-500 shadow-md ring-4 ring-transparent border-2 border-white"></div>
                        <span class="font-bold text-xl text-red-500">1</span>
                    </div>
                    <div onclick="setPuzzleTool(2)" class="puzzle-tool cursor-pointer flex flex-col items-center gap-1 hover:scale-110 transition transform active:scale-95" id="tool-2">
                        <div class="w-12 h-12 rounded-full bg-green-500 shadow-md ring-4 ring-transparent border-2 border-white"></div>
                        <span class="font-bold text-xl text-green-500">2</span>
                    </div>
                    <div onclick="setPuzzleTool(3)" class="puzzle-tool cursor-pointer flex flex-col items-center gap-1 hover:scale-110 transition transform active:scale-95" id="tool-3">
                        <div class="w-12 h-12 rounded-full bg-black shadow-md ring-4 ring-transparent border-2 border-white"></div>
                        <span class="font-bold text-xl text-black">3</span>
                    </div>
                </div>

                <!-- 8x8 è§£å¯†ç½‘æ ¼ -->
                <div id="puzzleGrid" class="grid grid-cols-8 gap-1 bg-gray-200 p-2 rounded-xl border-4 border-pink-300 shadow-lg" style="width: 340px; height: 340px;">
                    <!-- JS ç”Ÿæˆæ ¼å­ -->
                </div>

                <div class="mt-6 text-gray-400 text-sm">
                    æç¤ºï¼šç”¨æ­£ç¡®çš„é¢œè‰²ç‚¹å‡»å¯¹åº”çš„æ•°å­—æ ¼å­ã€‚
                </div>
                
                <button onclick="resetPuzzle()" class="mt-4 text-pink-400 underline hover:text-pink-600">
                    é‡æ–°å¼€å§‹
                </button>
            </div>
        </section>

        <!-- ç¬¬äº”è¯¾ï¼šåƒç´ åŠ¨ç”»å¸ˆ (Animationæ¨¡å¼) -->
        <section class="bg-white rounded-3xl p-6 md:p-8 shadow-xl border-b-8 border-indigo-400">
            <div class="flex flex-col items-center">
                <h2 class="text-3xl text-indigo-600 mb-6 flex items-center">
                    <span class="bg-indigo-100 p-2 rounded-lg mr-3">ğŸ¬</span>
                    ä»»åŠ¡äº”ï¼šåƒç´ åŠ¨ç”»å¸ˆ
                </h2>
                <p class="text-lg text-gray-500 mb-6 text-center">
                    åŠ¨ç”»ç‰‡å°±æ˜¯å›¾ç‰‡å˜å˜å¾—å¾ˆå¿«ï¼<br>
                    <span class="text-indigo-500 font-bold">ç”»ä¸¤ä¸ªä¸ä¸€æ ·çš„å›¾ï¼Œç„¶åç‚¹â€œæ’­æ”¾â€çœ‹çœ‹ï¼</span>
                </p>

                <!-- ä¸¤ä¸ªç”»æ¿å®¹å™¨ -->
                <div class="flex flex-col md:flex-row gap-8 items-center justify-center mb-6">
                    <!-- ç¬¬ä¸€å¸§ -->
                    <div class="flex flex-col items-center">
                        <span class="mb-2 font-bold text-gray-500 bg-gray-200 px-3 py-1 rounded-full">ç¬¬ä¸€å¼  (Frame 1)</span>
                        <div id="animGrid1" class="grid grid-cols-8 gap-0 border-4 border-indigo-300 shadow-md cursor-pointer" style="width: 160px; height: 160px;"></div>
                    </div>

                    <!-- ç®­å¤´ -->
                    <div class="text-4xl text-indigo-300 hidden md:block">â¡</div>
                    <div class="text-4xl text-indigo-300 md:hidden">â¬‡</div>

                    <!-- ç¬¬äºŒå¸§ -->
                    <div class="flex flex-col items-center">
                        <span class="mb-2 font-bold text-gray-500 bg-gray-200 px-3 py-1 rounded-full">ç¬¬äºŒå¼  (Frame 2)</span>
                        <div id="animGrid2" class="grid grid-cols-8 gap-0 border-4 border-indigo-300 shadow-md cursor-pointer" style="width: 160px; height: 160px;"></div>
                    </div>
                </div>

                <!-- æ’­æ”¾æ§åˆ¶ä¸é¢„è§ˆ -->
                <div class="flex flex-col items-center gap-4 bg-indigo-50 p-6 rounded-2xl w-full max-w-md border-2 border-indigo-100">
                    <div class="flex items-center gap-4">
                        <button onclick="toggleAnimation()" id="playBtn" class="bg-green-500 hover:bg-green-600 text-white text-xl font-bold py-3 px-8 rounded-full shadow-lg transition transform active:scale-95 flex items-center">
                            <span>â–¶ï¸ æ’­æ”¾åŠ¨ç”»</span>
                        </button>
                    </div>

                    <div class="mt-2 text-indigo-800 font-bold">
                        ğŸ“º ç”µè§†æœºé¢„è§ˆï¼š
                    </div>
                    <!-- é¢„è§ˆçª—å£ -->
                    <div class="relative w-32 h-32 bg-white rounded-lg border-4 border-gray-700 shadow-inner flex items-center justify-center overflow-hidden">
                        <div id="animPreview" class="grid grid-cols-8 gap-0 w-full h-full">
                            <!-- åŠ¨æ€å¡«å…… -->
                        </div>
                        <!-- æ‰«æçº¿æ•ˆæœ -->
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black opacity-10 pointer-events-none" style="background-size: 100% 4px;"></div>
                    </div>
                    <p class="text-sm text-gray-500">å°æç¤ºï¼šè¯•ç€ç”»ä¸€ä¸ªé—­çœ¼ç›çš„è„¸ï¼Œå’Œä¸€ä¸ªççœ¼ç›çš„è„¸ï¼</p>
                </div>
                
                <!-- ç®€å•é€‰è‰²å™¨ (å¤ç”¨é€»è¾‘) -->
                <div class="mt-6 flex gap-2">
                    <div class="text-gray-500 mr-2 flex items-center">å½“å‰é¢œè‰²:</div>
                    <button onclick="setAnimColor('black')" class="w-8 h-8 rounded bg-black border-2 border-white ring-2 ring-gray-300 shadow-sm"></button>
                    <button onclick="setAnimColor('red')" class="w-8 h-8 rounded bg-red-500 border-2 border-white ring-2 ring-gray-300 shadow-sm"></button>
                    <button onclick="setAnimColor('white')" class="w-8 h-8 rounded bg-white border-2 border-gray-300 shadow-sm flex items-center justify-center text-xs">ğŸ§¹</button>
                </div>
            </div>
        </section>

    </main>

    <!-- è„šæœ¬é€»è¾‘ -->
    <script>
        /* ------------------ ä»»åŠ¡ä¸€ï¼šåƒç´ å˜ç„¦é€»è¾‘ ------------------ */
        const canvas = document.getElementById('pixelCanvas');
        const ctx = canvas.getContext('2d');
        const slider = document.getElementById('resolutionSlider');
        const resValue = document.getElementById('resValue');
        
        ctx.imageSmoothingEnabled = false;
        const emoji = "ğŸ„";
        
        function drawPixelated(resolution) {
            canvas.width = resolution;
            canvas.height = resolution;
            ctx.imageSmoothingEnabled = false;
            ctx.font = `${resolution * 0.9}px serif`;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillStyle = "#e0f2fe"; 
            ctx.fillRect(0, 0, resolution, resolution);
            ctx.fillText(emoji, resolution / 2, resolution / 1.8);

            if (resolution < 10) {
                resValue.innerText = "å¾ˆå°‘ (çœ‹ä¸æ¸…å•¦!)";
                resValue.className = "font-bold text-2xl text-red-500";
            } else if (resolution < 40) {
                resValue.innerText = "ä¸€ç‚¹ç‚¹ (é©¬èµ›å…‹)";
                resValue.className = "font-bold text-2xl text-yellow-600";
            } else {
                resValue.innerText = "å¾ˆå¤š (è¶…çº§æ¸…æ¥š!)";
                resValue.className = "font-bold text-2xl text-green-600";
            }
        }
        slider.addEventListener('input', (e) => drawPixelated(parseInt(e.target.value)));
        drawPixelated(128);


        /* ------------------ ä»»åŠ¡äºŒï¼šç»˜ç”»æ¿é€»è¾‘ ------------------ */
        const grid = document.getElementById('pixelGrid');
        const colorDisplay = document.querySelector('#currentColorDisplay span');
        let currentColor = 'red';
        let isDrawing = false; 

        function initGrid() {
            grid.innerHTML = '';
            for (let i = 0; i < 100; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell bg-white w-full h-full border border-gray-100';
                cell.dataset.index = i;
                
                cell.addEventListener('mousedown', () => { cell.style.backgroundColor = currentColor; });
                cell.addEventListener('mouseenter', () => { if (isDrawing) cell.style.backgroundColor = currentColor; });
                cell.addEventListener('touchstart', (e) => { e.preventDefault(); cell.style.backgroundColor = currentColor; });

                grid.appendChild(cell);
            }
        }
        document.body.addEventListener('mousedown', () => isDrawing = true);
        document.body.addEventListener('mouseup', () => isDrawing = false);

        window.setColor = function(color) {
            currentColor = color;
            if(color === 'red') { updateColorDisplay("çº¢è‰²", "red", "white"); }
            else if(color === '#3b82f6') { updateColorDisplay("è“è‰²", "#3b82f6", "white"); }
            else if(color === '#22c55e') { updateColorDisplay("ç»¿è‰²", "#22c55e", "white"); }
            else if(color === '#facc15') { updateColorDisplay("é»„è‰²", "#facc15", "black"); }
            else if(color === 'black') { updateColorDisplay("é»‘è‰²", "black", "white"); }
            else if(color === 'white') { updateColorDisplay("æ©¡çš®æ“¦", "white", "black", true); }
        }

        function updateColorDisplay(text, bg, textCol, border = false) {
            colorDisplay.innerText = text;
            colorDisplay.style.backgroundColor = bg;
            colorDisplay.style.color = textCol;
            colorDisplay.style.border = border ? "1px solid #ccc" : "none";
        }

        window.clearGrid = function() {
            const cells = document.querySelectorAll('.grid-cell');
            cells.forEach(cell => { cell.style.backgroundColor = 'white'; cell.style.transform = "scale(1)"; });
            grid.classList.add('animate-pulse');
            setTimeout(() => grid.classList.remove('animate-pulse'), 500);
        }
        initGrid();

        /* ------------------ ä»»åŠ¡ä¸‰ï¼šå›¾ç‰‡åƒç´ åŒ–é€»è¾‘ ------------------ */
        const uploadInput = document.getElementById('uploadInput');
        const imageCanvas = document.getElementById('imageCanvas');
        const imageCtx = imageCanvas.getContext('2d');
        const imgSlider = document.getElementById('imagePixelSlider');
        const imgResText = document.getElementById('imgResText');
        const imgPlaceholder = document.getElementById('imgPlaceholder');
        const pixelControlArea = document.getElementById('pixelControlArea');
        let userImg = new Image();

        uploadInput.addEventListener('change', handleFile);

        function handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                userImg = new Image();
                userImg.onload = () => {
                    imgPlaceholder.style.display = 'none';
                    imageCanvas.classList.remove('hidden');
                    pixelControlArea.classList.remove('hidden');
                    imgSlider.value = 100;
                    processUserImage();
                };
                userImg.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        imgSlider.addEventListener('input', processUserImage);

        function processUserImage() {
            if (!userImg.width) return;
            const val = parseInt(imgSlider.value);
            let scale;
            if (val === 100) scale = 1;
            else scale = Math.pow(val / 100, 2); 

            const w = Math.max(2, Math.floor(userImg.width * scale));
            const h = Math.max(2, Math.floor(userImg.height * scale));
            
            imageCanvas.width = userImg.width;
            imageCanvas.height = userImg.height;
            imageCtx.imageSmoothingEnabled = false;
            
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = w; tempCanvas.height = h;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(userImg, 0, 0, w, h);
            imageCtx.drawImage(tempCanvas, 0, 0, w, h, 0, 0, imageCanvas.width, imageCanvas.height);
            
            if (val === 100) { imgResText.innerText = "é«˜æ¸…ç…§ç‰‡ (åƒé•œå­ä¸€æ ·)"; imgResText.className = "font-bold text-2xl text-green-600"; }
            else if (val > 80) { imgResText.innerText = "ç¨å¾®æ¨¡ç³Š (æœ‰ç‚¹å¤±çœŸ)"; imgResText.className = "font-bold text-2xl text-green-500"; }
            else if (val > 50) { imgResText.innerText = "å¤å¤æ¸¸æˆé£ (åƒç´ å¯è§)"; imgResText.className = "font-bold text-2xl text-yellow-600"; }
            else if (val > 20) { imgResText.innerText = "è¶…çº§é©¬èµ›å…‹ (æ–¹å—å¾ˆå¤§)"; imgResText.className = "font-bold text-2xl text-orange-500"; }
            else { imgResText.innerText = "å®Œå…¨å´©è§£ (çœ‹ä¸å‡ºæ¥å•¦)"; imgResText.className = "font-bold text-2xl text-red-600"; }
        }

        /* ------------------ ä»»åŠ¡å››ï¼šæ•°å­—è§£å¯†é€»è¾‘ ------------------ */
        const puzzleMap = [
            [0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0],
            [0,0,2,2,2,2,0,0], 
            [0,2,1,1,1,1,2,0], 
            [0,2,1,3,1,3,2,0], 
            [0,2,1,1,1,1,2,0], 
            [0,0,2,2,2,2,0,0], 
            [0,0,0,0,0,0,0,0]
        ];

        let puzzleTool = 1; 
        const puzzleGrid = document.getElementById('puzzleGrid');
        const puzzleMessage = document.getElementById('puzzleMessage');

        function setPuzzleTool(num) {
            puzzleTool = num;
            [1,2,3].forEach(n => {
                const el = document.getElementById(`tool-${n}`);
                const ringColor = (n === 1) ? 'ring-red-200' : (n === 2) ? 'ring-green-200' : 'ring-gray-300';
                if (n === num) {
                    el.classList.add(ringColor, 'scale-110');
                    el.children[0].classList.add('ring-4');
                } else {
                    el.classList.remove(ringColor, 'scale-110');
                    el.children[0].classList.remove('ring-4');
                }
            });
        }

        function initPuzzle() {
            puzzleGrid.innerHTML = '';
            setPuzzleTool(1); 
            puzzleMessage.innerText = "æ‹¿èµ·ç”»ç¬”å¼€å§‹å§ï¼";
            puzzleMessage.className = "h-8 mb-4 text-xl font-bold text-pink-500";

            for(let r=0; r<8; r++) {
                for(let c=0; c<8; c++) {
                    const val = puzzleMap[r][c];
                    const cell = document.createElement('div');
                    cell.className = 'number-cell bg-white rounded cursor-pointer border border-gray-100';
                    if (val === 0) { cell.style.backgroundColor = '#f3f4f6'; } 
                    else { cell.innerText = val; cell.onclick = () => checkPuzzleCell(cell, val); }
                    puzzleGrid.appendChild(cell);
                }
            }
        }

        function checkPuzzleCell(cell, targetVal) {
            if (cell.classList.contains('solved')) return;
            if (puzzleTool === targetVal) {
                cell.classList.add('solved');
                cell.innerText = ""; 
                if (targetVal === 1) cell.style.backgroundColor = '#ef4444'; 
                if (targetVal === 2) cell.style.backgroundColor = '#22c55e'; 
                if (targetVal === 3) cell.style.backgroundColor = 'black';   
                checkWin();
            } else {
                cell.classList.add('shake');
                setTimeout(() => cell.classList.remove('shake'), 500);
                puzzleMessage.innerText = "å“å‘€ï¼Œé¢œè‰²ä¸å¯¹å“¦ï¼å†è¯•è¯•ï¼Ÿ";
                puzzleMessage.className = "h-8 mb-4 text-xl font-bold text-red-500 animate-bounce";
                setTimeout(() => {
                   if(!puzzleMessage.innerText.includes("æ­å–œ")) {
                       puzzleMessage.innerText = "æ‹¿èµ·ç”»ç¬”åŠ æ²¹ï¼";
                       puzzleMessage.className = "h-8 mb-4 text-xl font-bold text-pink-500";
                   }
                }, 1500);
            }
        }

        function checkWin() {
            const allCells = document.querySelectorAll('.number-cell');
            let solvedCount = 0; let totalTarget = 0;
            puzzleMap.flat().forEach(v => { if(v !== 0) totalTarget++; });
            allCells.forEach(c => { if(c.classList.contains('solved')) solvedCount++; });
            if (solvedCount === totalTarget) {
                puzzleMessage.innerText = "ğŸ‰ å“‡ï¼ä½ æˆåŠŸè¿˜åŸäº†è¥¿ç“œï¼å¤ªæ£’äº†ï¼ ğŸ‰";
                puzzleMessage.className = "h-8 mb-4 text-2xl font-bold text-green-600 animate-bounce";
                puzzleGrid.classList.add('ring-4', 'ring-yellow-400');
            }
        }

        window.resetPuzzle = function() {
            puzzleGrid.classList.remove('ring-4', 'ring-yellow-400');
            initPuzzle();
        }
        initPuzzle();


        /* ------------------ ä»»åŠ¡äº”ï¼šåƒç´ åŠ¨ç”»å¸ˆé€»è¾‘ (NEW) ------------------ */
        const animGrid1 = document.getElementById('animGrid1');
        const animGrid2 = document.getElementById('animGrid2');
        const animPreview = document.getElementById('animPreview');
        const playBtn = document.getElementById('playBtn');
        let animColor = 'black';
        let isAnimating = false;
        let animationInterval;
        
        // 8x8 Grids
        // ä½¿ç”¨ç®€å•çš„æ•°ç»„æ¥å­˜å‚¨é¢œè‰²çŠ¶æ€: 'white' or 'color'
        let frame1Data = new Array(64).fill('white');
        let frame2Data = new Array(64).fill('white');

        function createAnimGrid(element, dataArray) {
            element.innerHTML = '';
            for(let i=0; i<64; i++) {
                const cell = document.createElement('div');
                cell.className = 'anim-cell w-full h-full';
                cell.style.backgroundColor = dataArray[i];
                
                // ç‚¹å‡»å¡«è‰²
                cell.onclick = () => {
                   dataArray[i] = animColor;
                   cell.style.backgroundColor = animColor;
                   if(!isAnimating) updatePreview(1); // å¦‚æœæ²¡åœ¨æ’­æ”¾ï¼Œæ›´æ–°é¢„è§ˆæ˜¾ç¤ºç¬¬ä¸€å¸§
                };
                element.appendChild(cell);
            }
        }

        // åˆå§‹åŒ–é¢„è§ˆç½‘æ ¼ (åªè¯»)
        function initPreviewGrid() {
            animPreview.innerHTML = '';
            for(let i=0; i<64; i++) {
                const cell = document.createElement('div');
                cell.className = 'w-full h-full border border-gray-100'; // æ— è¾¹æ¡†æ›´åƒå±å¹•
                cell.id = `preview-cell-${i}`;
                cell.style.backgroundColor = 'white';
                animPreview.appendChild(cell);
            }
        }

        function updatePreview(frameNum) {
            const data = frameNum === 1 ? frame1Data : frame2Data;
            for(let i=0; i<64; i++) {
                const cell = document.getElementById(`preview-cell-${i}`);
                if(cell) cell.style.backgroundColor = data[i];
            }
        }

        window.setAnimColor = function(c) { animColor = c; }

        window.toggleAnimation = function() {
            if (isAnimating) {
                // Stop
                clearInterval(animationInterval);
                isAnimating = false;
                playBtn.innerHTML = "<span>â–¶ï¸ æ’­æ”¾åŠ¨ç”»</span>";
                playBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                playBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                updatePreview(1); // Reset to frame 1
            } else {
                // Start
                isAnimating = true;
                playBtn.innerHTML = "<span>â¹ï¸ åœæ­¢</span>";
                playBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                playBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                
                let currentFrame = 1;
                updatePreview(1);
                
                animationInterval = setInterval(() => {
                    currentFrame = currentFrame === 1 ? 2 : 1;
                    updatePreview(currentFrame);
                }, 400); // 400ms speed
            }
        }

        // åˆå§‹åŒ–åŠ¨ç”»ä»»åŠ¡
        createAnimGrid(animGrid1, frame1Data);
        createAnimGrid(animGrid2, frame2Data);
        initPreviewGrid();

        // é¢„è®¾ä¸€ä¸ªç®€å•çš„é»˜è®¤å›¾æ¡ˆï¼ˆç¬‘è„¸çœ¨çœ¼ï¼‰
        // Frame 1: Open eyes
        const defaultEyeLeft = 18; const defaultEyeRight = 21;
        const mouthIndices = [42, 45, 50, 51, 52, 53];
        // ... simplified implementation just lets users draw mainly

    </script>
</body>
</html>
